# DreamForge — Headless Unity Development Environment

## Overview

You are working in a **headless Unity environment** running in batchmode with NO GUI or visual editor.

- **No GUI**: Unity runs in `batchmode -nographics` mode only
- **No Visual Editor**: All work is done entirely via code (C# files)
- **No VNC/Display**: You cannot use graphical tools or remote desktops
- **No Xvfb or Xwayland**: The environment is purely CLI-based

## Quick Start

### 1. Bootstrap the Environment (First Time Only)

Run the initialization script to set up Unity and activate the license:

```bash
bash /unity-init.sh
```

This script will:
- Clone the git repository (if `GIT_REPO_URL` is set)
- Activate the Unity license (from `.ulf` file or `UNITY_SERIAL` env var)
- Initialize Unity in batchmode
- Start the compilation watcher in the background

**Exit code behavior:**
- Exit 0: Success
- Exit 1 or non-zero: Check the output for error details (license, network, etc.)

### 2. Edit → Compile → Verify Cycle

Once the environment is initialized, follow this workflow:

1. **Modify C# files** in `/workspace/Assets/Scripts/` (or subdirectories)
2. **Trigger compilation:**
   ```bash
   bash /unity-compile.sh
   ```
3. **Check the status:**
   ```bash
   cat /tmp/unity-compile-status.json
   ```
4. **Verify success** — the status file contains:
   ```json
   {
     "status": "success",
     "errors": [],
     "timestamp": "2026-02-28T14:30:00Z"
   }
   ```

If `status` is not `"success"`, read the `errors` array and fix your code.

## Status JSON Reference

After running `/unity-compile.sh`, check `/tmp/unity-compile-status.json` for:

| Status | Meaning | Action |
|--------|---------|--------|
| `idle` | No compilation running; treated as success | Safe to proceed |
| `compiling` | Unity is currently compiling | Wait and retry status file |
| `success` | Compilation completed without errors | Proceed to testing/submission |
| `errors` | Compilation failed with errors | Fix errors in the `errors` array |

## Rules and Constraints

### What You CAN Do

- ✅ Edit C# files in `/workspace/Assets/Scripts/` (and subdirectories)
- ✅ Create new C# files in `/workspace/Assets/Scripts/`
- ✅ Use `Debug.Log()` for logging inside your C# code
- ✅ Edit configuration files in `/workspace/ProjectSettings/`
- ✅ Commit changes to git (if a repo is cloned)

### What You MUST NOT Do

- ❌ **Never** modify `/workspace/Library/` — This is auto-generated by Unity
- ❌ **Never** modify `/workspace/Temp/` — This is temporary build cache
- ❌ **Never** manually edit `/workspace/ProjectSettings/ProjectSettings.asset` directly
- ❌ **Never** open the Visual Editor GUI (there is none)
- ❌ **Never** use GUI tools like Xvfb, VNC, or code-server

## Logging

### Using Debug.Log() in C# Code

```csharp
using UnityEngine;

public class MyScript : MonoBehaviour
{
    void Start()
    {
        Debug.Log("Hello, headless world!");
    }
}
```

Logs appear in `/root/.config/unity3d/Editor.log` or `/workspace/Library/Logs/Editor.log`.

**To view logs:**
```bash
tail -f /root/.config/unity3d/Editor.log
```

## Verification Workflow

Always follow this pattern before reporting completion:

1. **Modify** your C# code
2. **Compile:**
   ```bash
   bash /unity-compile.sh
   ```
3. **Check status:**
   ```bash
   cat /tmp/unity-compile-status.json | grep '"status"'
   ```
4. **Verify `"status": "success"`** in the output
5. **Only then** report completion or make next changes

If you see `"errors"` in the JSON, diagnose and fix them before proceeding.

## Project Structure

```
/workspace/
├── Assets/
│   ├── Scripts/          ← Edit your C# files here
│   ├── Scenes/
│   ├── Prefabs/
│   └── Resources/
├── ProjectSettings/      ← Configuration (read-mostly)
├── Packages/             ← Package manifest (don't edit directly)
├── Library/              ← Auto-generated (DO NOT EDIT)
├── Temp/                 ← Build cache (DO NOT EDIT)
├── .gitignore
└── README.md
```

## Troubleshooting

### "Status file not found"

This means the compile-watcher might not be running. Check:
```bash
ps aux | grep compile-watcher
```

If it's not running, restart it:
```bash
bash /compile-watcher.sh &
```

### "Compilation failed with error CS..."

The `errors` array in `/tmp/unity-compile-status.json` contains error codes and messages. Common errors:

- **CS0246**: Missing namespace or type — check your `using` statements
- **CS1061**: Member doesn't exist — check the class/type spelling
- **CS0103**: Undefined variable — check variable declaration
- **CS0234**: Namespace doesn't contain type — wrong namespace

### Slow Compilation

First compilation is slower due to Unity setup. Subsequent compiles are faster.
If a single compilation takes >30s, the project may have errors — check the status JSON.

## Summary

1. **Initialize once:** `bash /unity-init.sh`
2. **Edit cycle:** Modify .cs → `bash /unity-compile.sh` → `cat /tmp/unity-compile-status.json`
3. **Verify success** before reporting completion
4. **Never edit** Library/ or Temp/
5. **Always use** status JSON to check results
